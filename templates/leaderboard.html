{% extends "base.html" %}

{% block content %}

<!-- Info flash container -->
<div id="info-flash-container" class="container mt-3"></div>


<h2 class="mb-4">Leaderboard</h2>



<!-- Game Toggle Buttons -->
<div class="btn-group mb-3" role="group">
    <a href="{{ url_for('leaderboard') }}"
       class="btn btn-outline-primary {% if not selected_game %}active{% endif %}">
        All Scores
    </a>

    {% for game in games %}
        <a href="{{ url_for('leaderboard', game=game) }}"
           class="btn btn-outline-primary {% if selected_game == game %}active{% endif %}">
            {{ game }}
        </a>
    {% endfor %}
</div>

<!-- Leaderboard Table -->
<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>#</th>
            <th style="width: 20%">Player</th>
            <th>Score</th>

            {% if not selected_game %}
                <th style="width: 20%">Game</th>
            {% endif %}

            <th class="text-center">Submitted By</th>
            <th class="text-center">Notes</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in leaderboard %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ entry.username }}</td>
            <td>
                {% if entry.link %}
                    <a href="{{ entry.link }}" target="_blank" class="score-link">
                        {{ "{:,}".format(entry.score) }}
                    </a>
                {% else %}
                    {{ "{:,}".format(entry.score) }}
                {% endif %}
            </td>

            {% if not selected_game %}
                <td>{{ entry.gameType }}</td>
            {% endif %}

            <td class="text-center">
                <span
                    class="info-emoji"
                    data-info="Submitted by {{ entry.submittedBy | e }}"
                    role="button"
                    tabindex="0"
                >❓</span>
            </td>

            <td class="text-center">
                {% if entry.notes %}
                    <span
                        class="info-emoji text-muted"
                        data-info="{{ entry.notes | e }}"
                        role="button"
                        tabindex="0"
                    >ℹ️</span>
                {% else %}
                    —
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Page-specific styles -->
<style>
.score-link {
    font-weight: 600;
    color: inherit;
    text-decoration: none;
}

.score-link:hover {
    text-decoration: underline;
    opacity: 0.8;
}

.info-emoji {
    cursor: pointer;
}
</style>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const flashContainer = document.getElementById("info-flash-container");

    document.addEventListener("click", function (event) {
        const emoji = event.target.closest(".info-emoji");
        if (!emoji) return;

        const info = emoji.dataset.info;
        if (!info) return;

        flashContainer.innerHTML = "";

        const alertDiv = document.createElement("div");
        alertDiv.className = "alert alert-info alert-dismissible fade show";
        alertDiv.setAttribute("role", "alert");
        alertDiv.innerHTML = `
            ${info}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        flashContainer.appendChild(alertDiv);

        flashContainer.scrollIntoView({
            behavior: "smooth",
            block: "start"
        });

        setTimeout(() => {
            alertDiv.classList.remove("show");
        }, 4000);
    });
});
</script>


{% endblock %}
